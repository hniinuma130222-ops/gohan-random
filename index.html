<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ã”ã¯ã‚“ãƒ©ãƒ³ãƒ€ãƒ </title>
<style>
 :root{
  --pad:16px;
  --accent:#e74c3c; /* é£Ÿæ¬²ã‚’ããã‚‹èµ¤ */
  --bg:#f9f9f9;
}
body{
  font-family: "Helvetica Neue", system-ui, sans-serif;
  margin:var(--pad);
  line-height:1.6;
  background: var(--bg);
}
h1{
  font-size:1.6rem;
  font-weight:700;
  margin:.2rem 0 1rem;
  text-align:center;
  color:#333;
}
button{
  padding:12px 18px;
  border:none;
  border-radius:12px;
  font-size:1rem;
  cursor:pointer;
  background: var(--accent);
  color:#fff;
  font-weight:600;
  box-shadow:0 4px 8px rgba(0,0,0,0.1);
  transition: transform 0.1s ease, background 0.2s ease;
}
button:hover{background:#c0392b;}
button:active{transform:scale(0.95);}
input,textarea,select{
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:10px;
  font-size:1rem;
}
.row{
  display:flex;
  gap:10px;
  align-items:center;
  margin:8px 0;
  flex-wrap:wrap;
}
.card{
  border:none;
  border-radius:16px;
  padding:16px;
  margin:16px 0;
  background:#fff;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}
.muted{color:#666;font-size:.9rem}
#result{
  font-size:2rem;
  font-weight:700;
  text-align:center;
  margin:20px 0;
  color:var(--accent);
  opacity:0;
  transition: opacity 0.4s ease;
}
</style>
<h1>ã”ã¯ã‚“ãƒ©ãƒ³ãƒ€ãƒ </h1>

<div class="card">
  <div class="row">
    <select id="category"></select>
    <button id="spin">ãˆã„ã£ï¼</button>
  </div>
  <p id="result"></p>
  <div class="row">
    <button id="openMaps">è¿‘ãã§æ¢ã™</button>
    <button id="reroll">ã‚‚ã†ä¸€å›</button>
  </div>
</div>

<div class="card">
  <h2 style="font-size:1.1rem;margin:.2rem 0 .4rem">å€™è£œç·¨é›†</h2>
  <p class="muted">ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼ˆä¾‹ï¼šãƒ©ãƒ¼ãƒ¡ãƒ³,ã‚«ãƒ¬ãƒ¼,ã™ã—ï¼‰</p>
  <div class="row"><input id="newCat" placeholder="ã‚«ãƒ†ã‚´ãƒªåï¼ˆä¾‹ï¼šå…¨éƒ¨, å’Œé£Ÿ, é€Ÿæ”»ï¼‰"><button id="addCat">ã‚«ãƒ†ã‚´ãƒªè¿½åŠ </button></div>
  <textarea id="items" rows="4" placeholder="ã“ã®ã‚«ãƒ†ã‚´ãƒªã®å€™è£œã‚’å…¥åŠ›"></textarea>
  <div class="row">
    <button id="save">ä¿å­˜</button>
    <button id="deleteCat">ã‚«ãƒ†ã‚´ãƒªå‰Šé™¤</button>
  </div>
</div>

<div class="card">
  <h2 style="font-size:1.1rem;margin:.2rem 0 .4rem">å±¥æ­´</h2>
  <ol id="history"></ol>
  <button id="clearHistory">å±¥æ­´ã‚¯ãƒªã‚¢</button>
</div>

<script>
const DEFAULT = {"ğŸ½ å…¨éƒ¨":["ğŸœ ãƒ©ãƒ¼ãƒ¡ãƒ³","ğŸ› ã‚«ãƒ¬ãƒ¼","ğŸ£ ã™ã—","ğŸ¥© ç„¼è‚‰","ğŸ± å®šé£Ÿ","ğŸ ãƒ‘ã‚¹ã‚¿","ğŸ¥— ã‚µãƒ©ãƒ€","ğŸ¤ ãã°","ğŸ² ã†ã©ã‚“","ğŸ³ ã‚ªãƒ ãƒ©ã‚¤ã‚¹"]};
const LS_KEY="gohan.categories", LS_HIST="gohan.history", LS_LAST="gohan.last";
const $ = s=>document.querySelector(s);
const categoryEl=$("#category"), itemsEl=$("#items"), newCatEl=$("#newCat");
const resultEl=$("#result"), historyEl=$("#history");

let cats = JSON.parse(localStorage.getItem(LS_KEY) || "null") || DEFAULT;
let hist = JSON.parse(localStorage.getItem(LS_HIST) || "[]");
let last = localStorage.getItem(LS_LAST) || "";

// ===== æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ =====
function fmtDateTime(ms){
  const d = new Date(ms);
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  return `${y}/${m}/${day} ${hh}:${mm}`;
}
function saveCats(){ localStorage.setItem(LS_KEY, JSON.stringify(cats)); }
function saveHist(){ localStorage.setItem(LS_HIST, JSON.stringify(hist.slice(-100))); }

// ===== æç”» =====
function renderCats(){
  categoryEl.innerHTML = Object.keys(cats).map(c=>`<option>${c}</option>`).join("");
  loadItems();
}
function loadItems(){ itemsEl.value = (cats[categoryEl.value]||[]).join(","); }
function renderHistory(){
  const rows = hist.slice().reverse().map(h=>{
    const timeMs = h.t || Date.now();
    const stamp = h.d || fmtDateTime(timeMs);
    return `<li>${stamp} â€” ${h.item} <span class="muted">(${h.cat})</span></li>`;
  });
  historyEl.innerHTML = rows.join("");
}

// ===== ãƒ©ãƒ³ãƒ€ãƒ é¸æŠï¼ˆè¢«ã‚Šé˜²æ­¢ï¼‰ =====
function pickRandom(list){
  if(!list.length) return null;
  if(list.length===1) return list[0];
  let pick;
  for(let i=0;i<10;i++){
    pick = list[(Math.random()*list.length)|0];
    if(pick!==last) break;
  }
  return pick;
}

// ===== ã‚¤ãƒ™ãƒ³ãƒˆ =====
$("#spin").onclick = ()=>{
  const c = categoryEl.value;
  const list = (cats[c]||[]).map(x=>x.trim()).filter(Boolean);
  if(!list.length){ resultEl.textContent="å€™è£œãŒç©ºã§ã™ã€‚ç·¨é›†ã§è¿½åŠ ã—ã¦ãã ã•ã„ã€‚"; resultEl.style.opacity=1; return; }
  const pick = pickRandom(list);
  if(!pick){ resultEl.textContent="å€™è£œãŒ1ä»¶ã®ã¿ã§ã™"; resultEl.style.opacity=1; return; }

  resultEl.style.opacity=0; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  setTimeout(()=>{
    resultEl.textContent = pick;
    resultEl.style.opacity=1;
  },200);

  last = pick; localStorage.setItem(LS_LAST, last);
  const now = Date.now();
  const stamp = fmtDateTime(now);
  hist.push({item: pick, cat: c, t: now, d: stamp});
  saveHist(); renderHistory();
};

$("#reroll").onclick = ()=>$("#spin").click();
$("#openMaps").onclick = ()=>{
  const q = (resultEl.textContent || "ãƒ©ãƒ³ãƒ");
  location.href = `https://www.google.com/maps/search/${encodeURIComponent(q)}`;
};

$("#addCat").onclick = ()=>{
  const name = (newCatEl.value||"").trim();
  if(!name) return;
  if(!cats[name]) cats[name]=[];
  newCatEl.value="";
  renderCats(); categoryEl.value = name; loadItems();
};

$("#save").onclick = ()=>{
  const c = categoryEl.value;
  cats[c] = itemsEl.value.split(",").map(s=>s.trim()).filter(Boolean);
  saveCats();
  resultEl.textContent = "ä¿å­˜ã—ã¾ã—ãŸ";
  resultEl.style.opacity=1;
  setTimeout(()=>resultEl.style.opacity=0,1000);
};

$("#deleteCat").onclick = ()=>{
  const c = categoryEl.value;
  if(Object.keys(cats).length===1){ alert("æœ€å¾Œã®ã‚«ãƒ†ã‚´ãƒªã¯å‰Šé™¤ã§ãã¾ã›ã‚“"); return; }
  if(confirm(`${c} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)){ delete cats[c]; saveCats(); renderCats(); }
};

$("#clearHistory").onclick = ()=>{
  if(confirm("å±¥æ­´ã‚’æ¶ˆã—ã¾ã™ã‹ï¼Ÿ")){ hist=[]; saveHist(); renderHistory(); }
};
categoryEl.onchange = loadItems;

// åˆæœŸæç”»
renderCats(); renderHistory();

</script>
